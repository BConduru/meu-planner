<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner High Performance v8.0 Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #1a365d; --secondary: #3498db; --success: #2ecc71;
            --danger: #e74c3c; --warning: #f39c12; --bg: #f8fafc; --card: #ffffff;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: #2d3748; margin: 0; padding: 15px; }
        .container { max-width: 1400px; margin: auto; }

        .header-card { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { margin: 0 0 15px 0; font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .cloud-status { float: right; font-size: 0.7rem; padding: 5px 10px; border-radius: 10px; background: #eee; font-weight: bold; }
        
        .meta-box { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-top: 10px; }
        .input-transparent { border: none; border-bottom: 2px solid var(--secondary); background: transparent; font-weight: bold; font-size: 1rem; padding: 5px; outline: none; width: 100%; max-width: 400px; }

        .progress-wrapper { margin-top: 15px; }
        .label-group { display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; }
        .progress-outer { background: #e2e8f0; border-radius: 20px; height: 12px; overflow: hidden; position: relative; }
        .progress-inner { height: 100%; background: var(--success); transition: width 0.5s ease; width: 0%; }
        .progress-inner.goal { background: var(--secondary); }

        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--primary); color: white; padding: 20px; border-radius: 15px; display: flex; justify-content: space-around; align-items: center; text-align: center; }
        .chart-card { background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; min-height: 200px; }
        .val { font-size: 1.5rem; font-weight: bold; color: var(--success); }
        .sub { font-size: 0.7rem; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px; }

        .planner-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; }
        .day-card { background: var(--card); border-radius: 15px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #edf2f7; }
        .day-title { font-size: 1.25rem; font-weight: 800; color: var(--secondary); border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 15px; }
        
        .section-title { font-size: 0.8rem; font-weight: bold; text-transform: uppercase; margin: 15px 0 10px 0; }
        .group { background: #f8fafc; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 0.9em; }
        .item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--success); }
        .item input[type="text"] { border: none; border-bottom: 1px solid #cbd5e0; background: transparent; flex: 1; outline: none; }

        .run-box { margin-top: 10px; padding: 12px; background: #ebf8ff; border-radius: 10px; display: none; border: 1px solid #bee3f8; }
        .run-box input { width: 60px; border: 1px solid #90caf9; border-radius: 4px; text-align: center; }
        
        .weight-box { background: #fffaf0; padding: 12px; border-radius: 10px; margin: 15px 0; border: 1px solid #feebc8; font-weight: bold; font-size: 0.9rem; }
        .w-input { width: 60px; border: none; border-bottom: 2px solid var(--warning); background: transparent; text-align: center; outline: none; }

        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 30px; color: white; font-weight: bold; display: none; z-index: 1000; }
        .actions { text-align: center; margin: 40px 0; display: flex; justify-content: center; gap: 10px; }
        .btn { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; }
        .btn-blue { background: var(--secondary); }
        .btn-red { background: var(--danger); }

        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="container">
    <div class="header-card">
        <div id="cloud-indicator" class="cloud-status">‚òÅÔ∏è Offline</div>
        <h1>üöÄ Planner de Performance</h1>
        <div class="header-row">
            Per√≠odo: <input type="text" id="periodo" class="input-header input-transparent" value="19 a 25/01/2026" oninput="salvar()">
        </div>
        
        <div class="meta-box">
            <strong>Meta Principal:</strong>
            <input type="text" id="meta-txt" class="input-transparent" placeholder="Digite aqui..." oninput="salvar()">
            <div class="progress-wrapper">
                <div class="label-group">
                    <span>Progresso do Objetivo</span>
                    <input type="range" id="meta-perc" min="0" max="100" value="0" oninput="atualizarUI(); salvar();">
                    <span id="meta-perc-val">0%</span>
                </div>
                <div class="progress-outer"><div id="meta-bar" class="progress-inner goal"></div></div>
            </div>
        </div>

        <div class="progress-wrapper">
            <div class="label-group"><span>CONCLU√çDO DA SEMANA (PRODUTIVIDADE GLOBAL)</span> <span id="global-perc">0%</span></div>
            <div class="progress-outer"><div id="global-bar" class="progress-inner"></div></div>
        </div>
    </div>

    <div class="dash-grid">
        <div class="stat-card">
            <div><div class="sub">Total Percorrido</div><div id="km-total" class="val">0.0</div><div class="sub">km</div></div>
            <div>
                <div class="sub">Objetivo KM</div>
                <input type="number" id="m-km" class="input-transparent" style="color:var(--success); width: 60px; text-align: center;" value="20" oninput="atualizarUI(); salvar();">
                <div class="progress-outer" style="height: 10px; width: 100px; margin-top: 8px;">
                    <div id="km-bar-inner" class="progress-inner"></div>
                </div>
                <div id="km-perc-text" style="font-size: 0.7rem; margin-top: 3px; font-weight: bold;">0%</div>
            </div>
            <div><div class="sub">Vel. M√©dia</div><div id="vel-avg" class="val">0.0</div><div class="sub">km/h</div></div>
        </div>
        <div class="chart-card"><canvas id="wChart"></canvas></div>
    </div>

    <div id="days-container" class="planner-grid"></div>

    <div class="actions no-print">
        <button class="btn btn-blue" onclick="forceSync()">üîÑ Sincronizar Agora</button>
        <button class="btn btn-blue" onclick="window.print()">Gerar PDF</button>
        <button class="btn btn-red" onclick="reset()">Zerar Tudo</button>
    </div>
</div>

<script>
    // COLE O SEU URL DO GOOGLE SCRIPT AQUI:
    const CLOUD_API_URL = "https://script.google.com/macros/s/AKfycby_yBPVPIMGoLUVXwpQ6SJcuT15dr9wqzSenn5T4VXM-H5Gmg9wq1gXAPIffxzbwOA/exec";

    const DIAS = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"];
    
    let wChart;

    function init() {
        const container = document.getElementById('days-container');
        let html = '';
        DIAS.forEach(dia => {
            html += `
            <div class="day-card">
                <div class="day-title">${dia}</div>
                <div class="section-title" style="color:var(--danger)">üî• Cr√≠tico</div>
                <div class="group">
                    <div class="item"><input type="checkbox" class="track" id="c-ck-${dia}-1" onclick="salvar()"><input type="text" id="c-tx-${dia}-1" placeholder="Fazer..." oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="c-ck-${dia}-2" onclick="salvar()"><input type="text" id="c-tx-${dia}-2" placeholder="Fazer..." oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="c-ck-${dia}-3" onclick="salvar()"><input type="text" id="c-tx-${dia}-3" placeholder="Fazer..." oninput="salvar()"></div>
                </div>
                <div class="section-title" style="color:var(--success)">üå± Rotina</div>
                <div class="group">
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-1" onclick="salvar()"><input type="text" id="r-tx-${dia}-1" placeholder="Buscar filho" oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-2" onclick="salvar()"><input type="text" id="r-tx-${dia}-2" placeholder="T√™nis" oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-3" onclick="salvar()"><input type="text" id="r-tx-${dia}-3" placeholder="Missa" oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-4" onclick="salvar()"><input type="text" id="r-tx-${dia}-4" placeholder="Extra..." oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-5" onclick="salvar()"><input type="text" id="r-tx-${dia}-5" placeholder="Extra..." oninput="salvar()"></div>
                    <div class="item"><input type="checkbox" class="track" id="r-ck-${dia}-6" onclick="salvar()"><input type="text" id="r-tx-${dia}-6" placeholder="Extra..." oninput="salvar()"></div>
                </div>
                <div class="weight-box">Peso: <input type="number" step="0.1" id="p-${dia}" class="w-input" onchange="checkPeso('${dia}')"> kg</div>
                <div class="group">
                    <label class="item"><input type="checkbox" class="track" id="chk-d1-${dia}" onclick="salvar()"> Dieta</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-d2-${dia}" onclick="salvar()"> Exerc√≠cio</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-d3-${dia}" onclick="salvar()"> Estudo / Aprendizado</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-d4-${dia}" onclick="salvar()"> Medita√ß√£o / Organiza√ß√£o</label>
                    <label class="item"><input type="checkbox" id="run-ck-${dia}" onchange="toggleRun('${dia}')"> Corrida</label>
                    <div id="run-p-${dia}" class="run-box">
                        Km: <input type="number" id="r-km-${dia}" class="run-km-input" step="0.1" oninput="calcRun('${dia}')"> | 
                        Tempo: <input type="text" id="r-tm-${dia}" placeholder="mm:ss" oninput="calcRun('${dia}')">
                        <div id="r-vl-${dia}" style="font-weight:bold; margin-top:5px; font-size:0.8rem">Vel: 0.0 km/h</div>
                    </div>
                    <label class="item"><input type="checkbox" class="track" id="chk-e1-${dia}" onclick="salvar()"> Banho gelado</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-e2-${dia}" onclick="salvar()"> Separar roupa</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-e3-${dia}" onclick="salvar()"> Leitura</label>
                    <label class="item"><input type="checkbox" class="track" id="chk-e4-${dia}" onclick="salvar()"> Rem√©dio</label>
                </div>
            </div>`;
        });
        container.innerHTML = html;
        
        const ctx = document.getElementById('wChart');
        wChart = new Chart(ctx, {
            type: 'line',
            data: { labels: DIAS, datasets: [{ label: 'Peso', data: DIAS.map(()=>null), borderColor: '#3498db', tension: 0.4, fill: true, backgroundColor: 'rgba(52,152,219,0.1)' }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: false } }
        });
        
        loadFromCloud();
    }

    async function forceSync() {
        const ind = document.getElementById('cloud-indicator');
        ind.innerText = "‚è≥ Sincronizando...";
        await salvar(true);
    }

    async function salvar(force = false) {
        const data = {};
        document.querySelectorAll('input').forEach(el => data[el.id] = el.type === 'checkbox' ? el.checked : el.value);
        DIAS.forEach(d => {
            const el = document.getElementById(`r-vl-${d}`);
            if(el) data[`v-${d}`] = el.innerText;
        });
        
        localStorage.setItem('planner_cloud_v8', JSON.stringify(data));
        atualizarUI();

        if(force || Math.random() > 0.8) {
             try {
                await fetch(CLOUD_API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                });
                document.getElementById('cloud-indicator').innerText = "‚úÖ Nuvem Atualizada";
            } catch (e) {
                document.getElementById('cloud-indicator').innerText = "‚ùå Erro na Nuvem";
            }
        }
    }

    async function loadFromCloud() {
        const ind = document.getElementById('cloud-indicator');
        ind.innerText = "‚è≥ Carregando...";
        
        const local = localStorage.getItem('planner_cloud_v8');
        if (local) applyData(JSON.parse(local));

        try {
            const response = await fetch(CLOUD_API_URL);
            const cloudData = await response.json();
            if (cloudData && Object.keys(cloudData).length > 0) {
                applyData(cloudData);
                localStorage.setItem('planner_cloud_v8', JSON.stringify(cloudData));
                ind.innerText = "‚úÖ Nuvem Conectada";
            }
        } catch (e) {
            ind.innerText = "‚ö†Ô∏è Modo Local";
        }
        atualizarUI();
    }

    function applyData(data) {
        Object.keys(data).forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                if (el.type === 'checkbox') {
                    el.checked = data[id];
                    if (id.startsWith('run-ck-')) toggleRun(id.replace('run-ck-',''));
                } else el.value = data[id];
            }
        });
        DIAS.forEach(d => { if(data[`v-${d}`]) {
            const el = document.getElementById(`r-vl-${d}`);
            if(el) el.innerText = data[`v-${d}`];
        }});
    }

    function atualizarUI() {
        let tKm = 0, tH = 0;
        DIAS.forEach(d => {
            const k = parseFloat(document.getElementById(`r-km-${d}`).value) || 0;
            const t = document.getElementById(`r-tm-${d}`).value;
            tKm += k;
            if (t.includes(':')) {
                const p = t.split(':');
                tH += (parseInt(p[0])/60) + (parseInt(p[1])/3600);
            }
        });
        const metaKm = parseFloat(document.getElementById('m-km').value) || 1;
        const kmPerc = Math.min((tKm / metaKm) * 100, 100);
        
        document.getElementById('km-total').innerText = tKm.toFixed(1);
        document.getElementById('vel-avg').innerText = tH > 0 ? (tKm/tH).toFixed(1) : '0.0';
        document.getElementById('km-bar-inner').style.width = kmPerc + '%';
        document.getElementById('km-perc-text').innerText = kmPerc.toFixed(0) + '%';

        const mPerc = document.getElementById('meta-perc').value;
        document.getElementById('meta-perc-val').innerText = mPerc + '%';
        document.getElementById('meta-bar').style.width = mPerc + '%';

        const checks = document.querySelectorAll('input.track[type="checkbox"]');
        const checked = Array.from(checks).filter(c => c.checked).length;
        const globalPerc = checks.length > 0 ? Math.round((checked / checks.length) * 100) : 0;
        document.getElementById('global-perc').innerText = globalPerc + '%';
        document.getElementById('global-bar').style.width = globalPerc + '%';

        if(wChart) {
            wChart.data.datasets[0].data = DIAS.map(d => parseFloat(document.getElementById(`p-${d}`).value) || null);
            wChart.update();
        }
    }

    function checkPeso(dia) {
        atualizarUI(); salvar();
        const pesos = DIAS.map(d => parseFloat(document.getElementById(`p-${d}`).value)).filter(v => !isNaN(v));
        if (pesos.length > 1) {
            const diff = (parseFloat(document.getElementById(`p-${dia}`).value) - pesos[0]).toFixed(1);
            showToast(diff < 0 ? `Evolu√ß√£o: -${Math.abs(diff)}kg! üìâ` : diff > 0 ? `Aten√ß√£o: +${diff}kg. üìà` : "Est√°vel", diff <= 0 ? '#2ecc71' : '#f39c12');
        }
    }

    function showToast(m, c) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.backgroundColor = c; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    function toggleRun(d) {
        const runP = document.getElementById(`run-p-${d}`);
        if(runP) runP.style.display = document.getElementById(`run-ck-${d}`).checked ? 'block' : 'none';
        salvar();
    }

    function calcRun(d) {
        const k = parseFloat(document.getElementById(`r-km-${d}`).value) || 0;
        const t = document.getElementById(`r-tm-${d}`).value;
        if (k > 0 && t.includes(':')) {
            const p = t.split(':');
            const h = (parseInt(p[0])/60) + (parseInt(p[1])/3600);
            const vl = document.getElementById(`r-vl-${d}`);
            if(vl) vl.innerText = `Vel: ${(k/h).toFixed(1)} km/h`;
        }
        atualizarUI();
    }

    function reset() { if (confirm("Zerar semana?")) { localStorage.removeItem('planner_cloud_v8'); location.reload(); } }

    window.onload = init;
</script>
</body>
</html>